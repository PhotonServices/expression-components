<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../bower_components/x-websocket/dist/x-websocket.html">
<link rel="import" href="sentiment-card.html">
<link href='http://fonts.googleapis.com/css?family=Roboto:400,300,100' rel='stylesheet' type='text/css'>
<polymer-element name="expression-app" attributes="socket">
  <template>
  <style>
  :host core-header-panel {
    width: 100%;
    height: 100%;
  }
  :host .core-header {
    height: 80px;
    padding: 0 10px;
    background-color: #107FC9;
    color: #FFF;
    transition: height 0.2s;
    border-bottom: 2px solid #0E71B3;
  }
  :host .core-header.tall {
    height: 180px;
    border-bottom: 10px solid #0E71B3;
  }
  :host .core-header.medium-tall {
    height: 120px;
    border-bottom: 10px solid #0E71B3;
  }
  :host #content {
    background: linear-gradient(#FCFEF5,#FFF);
    overflow: hidden;
  }
  :host .badge {
    float: left;
    width: 60px;
    height:60px;
    margin:5px;
    border-radius: 60px;
    background: #EEEEEE;
    -web-kit-box-shadow:0px 2px 4px 0px rgba(0,0,0,0.50);
    -moz-box-shadow:    0px 2px 4px 0px rgba(0,0,0,0.50);
    box-shadow:         0px 2px 4px 0px rgba(0,0,0,0.50);
  }
  :host .badge core-icon {
    width: 100%;
    height: 100%;
    display: block;
    margin: auto;
  }
  :host .badge core-icon > svg {
    fill: #515151;
    transform:scale(.75);
    -moz-transform:scale(.75);
    -webkit-transform:scale(.75);
  }
  :host #text{
    margin-left: 10px;
  }
  :host #title {
    font-weight: 300;
    font-family: 'Roboto','Helvetica', sans-serif;
    font-size: 145%;
    font-size: 3.5vmax;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  :host #subtitle {
    padding: 3px;
    float: right;
    font-size: 70%;
    font-weight: 400;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    font-family: 'Roboto','Helvetica', sans-serif;
  }
  </style>
  <core-header-panel mode="waterfall-tall" tallclass="medium-tall">
    <div class="core-header" horizontal layout center>
      <div class="badge" horizontal layout center>
        <core-icon id="img" icon="maps:local-florist"></core-icon>
      </div>
      <div id="text">
        <div id="title">My Sentiment WebApp (Demo)</div>
        <div id="subtitle">powered by<u>Expression</u></div>
      </div>
    </div>
  </div>
  <div id="content" horizontal layout wrap center>
    <!-- <sentiment-card sentiment ="2"
    cardname  ="Reforma energÃ©tica"
    cardicon  ="maps:local-florist"
    socket="ws://localhost:8080/ws"></sentiment-card>
    <sentiment-card sentiment="1"
    cardname="#ItsFallBecause"
    cardicon="content-cut"
    socket="ws://localhost:8080/ws"></sentiment-card> -->
    <!-- <sentiment-card sentiment="2" cardname="iOS 8.0.1"     cardicon="drive"></sentiment-card>
    <sentiment-card sentiment="1" cardname="Nick Cannon"   cardicon="drive-chart"></sentiment-card>
    <sentiment-card sentiment="2" cardname="Wiz and Amber" cardicon="drive-image"></sentiment-card>
    <sentiment-card sentiment="1" cardname="iPhone 6"      cardicon="extension"></sentiment-card>
    <sentiment-card sentiment="-2"cardname="Ronaldinho"    cardicon="explore"></sentiment-card>
    <sentiment-card sentiment="1" cardname="Puebla"        cardicon="flag"></sentiment-card>
    <sentiment-card sentiment="1" cardname="Ice Bucket Challenge" cardicon="device:airplanemode-on"></sentiment-card>
    <sentiment-card sentiment="-1"cardname="#CongratulationsOn6MillionZoe" cardicon="hardware:gamepad"></sentiment-card>
    <sentiment-card sentiment="1" cardname="#BamNewVideo" cardicon="image:color-lens"></sentiment-card>
    <sentiment-card sentiment="-2"cardname="Veracruz" cardicon="image:camera-alt"></sentiment-card> -->
  </div>
</core-header-panel>
<x-websocket id="newCardSocket" url="{{socket}}" ></x-websocket>
</template>
<script>
Polymer('expression-app', {
  ready: function() {
    var self = this.$;
    var socket = this.socket;
    /*
    * New card WebSocket event handler.
    */
    self.newCardSocket.addEventListener("open", function() {
      self.newCardSocket.send('{"path": "events", "message": "subscribe", "content": "card-new"}');
    });
    self.newCardSocket.addEventListener("message", function(event) {
      if(JSON.parse(event.detail.data).data.name){
        console.log(JSON.parse(event.detail.data).data.id);
        var myArray = ["extension", "image:color-lens", "image:camera-alt","flag","explore","extension","maps:local-florist","content-cut"];
        var card = document.createElement("sentiment-card");
        card.setAttribute("sentiment","0");
        card.setAttribute("cardname",JSON.parse(event.detail.data).data.name);
        card.setAttribute("cardicon",myArray[Math.floor(Math.random() * myArray.length)]);
        card.setAttribute("cardid",JSON.parse(event.detail.data).data.id);
        card.setAttribute("socket",socket);
        self.content.appendChild(card);
      }
    });
  }
});
</script>
</polymer-element>
