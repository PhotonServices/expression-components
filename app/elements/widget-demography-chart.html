<!--
@license
The MIT License (MIT)

Copyright (c) 2014 The Photon Services Authors. All rights reserved.
This code may only be used under the BSD style license
found at http://opensource.org/licenses/MIT

-->
<!-- Widget demography-chart element
Author: Francisco Gutiérrez (fsalvador23@gmail.com)
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-icon/core-icon.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/core-icons/social-icons.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="../bower_components/x-websocket/dist/x-websocket.html">
<link rel="import" href="../bower_components/core-animation/core-animation.html">
<link rel="import" href="widget-folksonomy-list.html">

<polymer-element name="widget-demography-chart"
  attributes="active cardId socket"
  vertical layout center>
  <template>
  <style>
  :host{
    cursor: pointer;
    -webkit-font-smoothing: antialiased;
  }
  :host core-icon > svg{
    fill: white;
    transform:        scale(3);
    -moz-transform:   scale(3);
    -webkit-transform:scale(3);
  }
  :host #button {
    font-size:  12px;
    background: #107FC9;
    color:  #fff;
    width:  90px;
    height: 28px;
  }
  :host #folkChart{
    position: absolute;
    visibility: hidden;
    left: 0;
  }
  :host #backButton {
    position: absolute;
    left: -50px;
    top:  18px;
    background:#107FC9;
    visibility: hidden;
  }
  :host #backButton::shadow svg {
    transform:        scale(1);
    -moz-transform:   scale(1);
    -webkit-transform:scale(1);
    fill: white;
  }
  </style>
  <div id="widget" vertical layout center>
    <paper-fab icon="chevron-left" class="mini" id="backButton" on-tap="{{backHandler}}"></paper-fab>
    <core-icon icon="social:people"></core-icon>
    <paper-button id="button" label="1,000" raisedButton  on-tap="{{tapHandler}}"></paper-button>
    <widget-folksonomy-list id="folkChart" folksonomy='{"folksonomy": [
    "Peña Nieto",
    "Reforma",
    "Gasolina",
    "Capital",
    "Precio",
    "Familia",
    "Reforma",
    "Gasolina",
    "Capital",
    "Precio",
    "Familia",
    "Reforma",
    "Gasolina",
    "Capital",
    "Precio",
    "Familia",
    "Ice Bucket Challenge"
    ]}' scrolling="true"></widget-folksonomy-chart>
  </div>
  <x-websocket id="cardSocket" url="{{socket}}" ></x-websocket>
</template>
<script>
Polymer('widget-demography-chart', {
  attached: function() {
    if(this.active == "false") {
      var self = this.$;
      self.button.setAttribute("raisedButton","false");
      self.button.style.background = "grey";
    }
  },
  tapHandler: function() {
    var self = this.$;
    if(this.active == "true") {
      self.folkChart.style.visibility  = "visible";
      var anmTranslate = new CoreAnimation();
      anmTranslate.duration = 250;
      anmTranslate.fill = "forwards"
      anmTranslate.keyframes = [{transform: "translate(0px,0px)"},{transform: "translate(-50px,0px)"}];
      anmTranslate.target = self.widget;
      anmTranslate.play();
      anmTranslate.addEventListener('core-animation-finish', function(e) {
        var anmTranslate = new CoreAnimation();
        anmTranslate.duration = 300;
        anmTranslate.fill = "forwards"
        anmTranslate.keyframes = [{transform: "translate(-50px,0px)"},{transform: "translate(-50px,-50px)"}];
        anmTranslate.target = self.widget;
        anmTranslate.play();
        anmTranslate.addEventListener('core-animation-finish', function(e) {
          self.backButton.style.visibility = "visible";
        });
      });
      this.asyncFire('tapped-demography-chart-button');
    }
  },
  backHandler: function() {
    var self = this.$;
    self.backButton.style.visibility = "hidden";
    self.folkChart.style.visibility  = "hidden";
    var anmTranslate = new CoreAnimation();
    anmTranslate.duration = 400;
    anmTranslate.fill = "forwards"
    anmTranslate.keyframes = [{transform: "translate(-50px,-50px)"},{transform: "translate(0px,-50px)"}];
    anmTranslate.target = self.widget;
    anmTranslate.play();
    anmTranslate.addEventListener('core-animation-finish', function(e) {
      var anmTranslate = new CoreAnimation();
      anmTranslate.duration = 250;
      anmTranslate.fill = "forwards"
      anmTranslate.keyframes = [{transform: "translate(0px,-50px)"},{transform: "translate(0px,0px)"}];
      anmTranslate.target = self.widget;
      anmTranslate.play();
    });
    this.asyncFire('back-demography-chart-handler');
  }
});
</script>
</polymer-element>
